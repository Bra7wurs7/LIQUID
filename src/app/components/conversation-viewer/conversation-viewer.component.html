<div class="w-full h-full flex flex-row">
    <textarea *ngIf="conversation.messages.length > 0 && conversation.messages[activeMessage] !== undefined" #msgarea
        pInputTextarea class="dialog-prompt-textarea" placeholder="Edit message text here" [ngClass]="{
              'inactive': !conversation.messages[activeMessage].active,
            }" [(ngModel)]="conversation.messages[activeMessage].content"></textarea>
    <div *ngIf="conversation.messages.length === 0 || conversation.messages[activeMessage] === undefined"
        class="dialog-prompt-textarea-placeholder">
        <div class="tutorial-text">
            This LLM conversation has no messages.<br>
            You can add a message and prompt the llm in one go by typing in the text field below and pressing enter.<br>
            Use the 'Add message' button to the bottom right to add an empty message.
        </div>
    </div>
    <div class="menu-list"
        (wheel)="activeMessage = scrollIncrementDecrement(false, $event, activeMessage, 1, conversation.messages.length-1)">
        <div class="menu-item-container">
            <div class="menu-item transparent-bottom-border">
                <input class="menu-item-input fade-in-on-hover-child width-158px">
                <div class="iconoir iconoir-settings menu-item-icon hover-highlighting right-6px"></div>
            </div>
        </div>
        <div>
            <div class="menu-item-container margin-top-2" [pTooltip]="addMessageTooltip"
                (click)="addEmptyMessage(conversation.messages, true)"
                (contextmenu)="addEmptyMessage(conversation.messages, false); $event.preventDefault()">
                <div class="menu-item transparent-top-border">
                    <div class="menu-item-text right-6px">
                        Add Message</div>
                    <div class="iconoir iconoir-chat-plus-in menu-item-icon right-6px"></div>
                </div>
                <ng-template #addMessageTooltip>
                    <div class="flex justify-content-between align-items-center tooltip-background"
                        style="margin-bottom: 2px;">
                        To start of conversation<div class="iconoir iconoir-mouse-button-left">
                        </div>
                    </div>
                    <div class="flex justify-content-between align-items-center tooltip-background"
                        style="margin-bottom: 2px;">
                        To end of conversation<div class="iconoir iconoir-mouse-button-right"></div>
                    </div>
                </ng-template>
            </div>
            <div class="menu-item-container" (click)="activeMessage = idx;"
                *ngFor="let msg of conversation.messages ?? []; index as idx">
                <div class="menu-item grow-on-hover" [ngClass]="{
                    'active':activeMessage === idx, 
                    'system': msg.role === 'system',
                    'user': msg.role === 'user',
                    'assistant': msg.role === 'assistant',
                    'inactive': !msg.active
                    }" (contextmenu)="rightClickedMessage = idx; messageContextMenu.toggle($event)">
                    <div class="menu-item-text" [ngClass]="{'faint': msg.content.length === 0}">
                        {{msg.content.length > 0 ? msg.content : 'Empty Message'}}</div>
                    <div class="menu-item-icon author-icon iconoir right-6px"
                        [pTooltip]="msg.role === 'user' ? 'Outgoing message' : (msg.role === 'assistant' ? 'Incoming message' : 'Context message')"
                        tooltipPosition="left"
                        (click)="msg.role === 'assistant' ? msg.role = 'system' : (msg.role === 'user' ? msg.role = 'assistant' : msg.role = 'user'); $event.stopPropagation()"
                        [ngClass]="{
                                'iconoir-bubble-outcome': msg.role === 'user',
                                'iconoir-bubble-income': msg.role === 'assistant',
                                'iconoir-chat-lines-solid': msg.role === 'system',
                            }"></div>
                </div>
                <p-contextMenu #messageContextMenu [model]="messageContextMenuItems" [triggerEvent]="'click'"
                    appendTo="body"></p-contextMenu>
            </div>
        </div>
    </div>
</div>