<div class="w-full h-full flex flex-row">
    <textarea *ngIf="conversation.messages.length > 0 && conversation.messages[activeMessage] !== undefined" #msgarea pInputTextarea class="dialog-prompt-textarea" placeholder="Edit message text here" [ngClass]="{
              'inactive': !conversation.messages[activeMessage].active,
            }" [(ngModel)]="conversation.messages[activeMessage].content"></textarea>
    <div *ngIf="conversation.messages.length === 0 || conversation.messages[activeMessage] === undefined"
        class="dialog-prompt-textarea-placeholder">
        <div class="tutorial-text">
            This LLM conversation has no messages.<br>
            You can add a message and prompt the llm in one go by typing in the text field below and pressing enter.<br>
            Use the 'Add message' button to the bottom right to add an empty message.
        </div>
    </div>
    <div class="flex flex-column message-list"
        (wheel)="activeMessage = scrollIncrementDecrement(false, $event, activeMessage, 1, conversation.messages.length-1)">
        <div class="new-message-button faint" [pTooltip]="addMessageTooltip"
            (click)="addEmptyMessage(conversation.messages, false)"
            (contextmenu)="addEmptyMessage(conversation.messages, true); $event.preventDefault()">
            Add Message
            <div class="iconoir iconoir-chat-plus-in dialog-prompt-action"></div>
            <ng-template #addMessageTooltip>
                <div class="flex justify-content-between align-items-center tooltip-background"
                    style="margin-bottom: 2px;">
                    Add to end of conversation<div class="iconoir iconoir-mouse-button-left"></div>
                </div>
                <div class="flex justify-content-between align-items-center tooltip-background"
                    style="margin-bottom: 2px;">
                    Add to start of conversation<div class="iconoir iconoir-mouse-button-right">
                    </div>
                </div>
            </ng-template>
        </div>
        <div class="message-preview-container" (click)="activeMessage = idx;"
            *ngFor="let msg of conversation.messages ?? []; index as idx">
            <div #msgPreview class="message-preview flex flex-row align-items-center justify-content-between" [ngClass]="{
                    'active':activeMessage === idx, 
                    'system': msg.role === 'system',
                    'user': msg.role === 'user',
                    'assistant': msg.role === 'assistant',
                    'inactive': !msg.active
                    }" (contextmenu)="rightClickedMessage = idx; messageContextMenu.toggle($event)">
                <div class="message-preview-text" [ngClass]="{'faint': msg.content.length === 0}">
                    {{msg.content.length > 0 ? msg.content : 'Empty Message'}}</div>
                <div class="author-icon iconoir"
                    [pTooltip]="msg.role === 'user' ? 'Outgoing message' : (msg.role === 'assistant' ? 'Incoming message' : 'Context message')"
                    tooltipPosition="left"
                    (click)="msg.role === 'assistant' ? msg.role = 'system' : (msg.role === 'user' ? msg.role = 'assistant' : msg.role = 'user'); $event.stopPropagation()"
                    [ngClass]="{
                                'iconoir-bubble-outcome': msg.role === 'user',
                                'iconoir-bubble-income': msg.role === 'assistant',
                                'iconoir-chat-lines-solid': msg.role === 'system',
                            }"></div>
            </div>
            <p-contextMenu #messageContextMenu [model]="messageContextMenuItems" [triggerEvent]="'click'"
                appendTo="body"></p-contextMenu>
        </div>
    </div>
</div>